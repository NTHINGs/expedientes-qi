<!-- PHP VARIABLES -->
<!-- %CURRENT_USER% = Usuario Loggeado -->
<!-- REQUEST_URI = URL para guardar al paciente -->
<h1 class="entry-title" id="nombre_title"></h1>
<h1 class="entry-title" id="error_title"></h1>
<div class="container">
    <div class="row">
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-informacion-personal-tab" data-toggle="tab" href="#nav-informacion-personal"
                    role="tab" aria-controls="nav-informacion-personal" aria-selected="true">Información Personal</a>
                <a class="nav-item nav-link" id="nav-contactos-tab" data-toggle="tab" href="#nav-contactos" role="tab"
                    aria-controls="nav-contactos" aria-selected="false">Personas De Contacto</a>
                <a class="nav-item nav-link" id="nav-riesgos-psicosociales-tab" data-toggle="tab" href="#nav-riesgos-psicosociales"
                    role="tab" aria-controls="nav-riesgos-psicosociales" aria-selected="false">Riesgos Psicosociales</a>
                <a class="nav-item nav-link" id="nav-psicotropicos-tab" data-toggle="tab" href="#nav-psicotropicos"
                    role="tab" aria-controls="nav-psicotropicos" aria-selected="false">Uso de Sustancias</a>
                <a class="nav-item nav-link" id="nav-fases-tab" data-toggle="tab" href="#nav-fases" role="tab"
                    aria-controls="nav-fases" aria-selected="false">Fases</a>
                <a class="nav-item nav-link" id="nav-fad-tab" data-toggle="tab" href="#nav-fad" role="tab"
                    aria-controls="nav-fad" aria-selected="false">FAD</a>
            </div>
        </nav>
        <div class="col-12">
            <form class="row" action="%REQUEST_URI%" method="POST" enctype="multipart/form-data">
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-informacion-personal" role="tabpanel"
                        aria-labelledby="nav-informacion-personal-tab">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12 col-sm-6">
                                    <label for="nombre">Fotografía Actual</label>
                                    <br>
                                    <img src="/wp-content/plugins/expedientes-qi/default.png" id="fotografia_element"
                                        width="150px">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="nombre">Fotografía</label>
                                    <input type="file" class="form-control" name="fotografia" id="fotografia">
                                </div>
                                <div class="form-group col-12">
                                    <label for="nombre">Nombre</label>
                                    <input type="text" class="form-control" id="nombre" name="nombre" required>
                                </div>
                                <div class="form-group col-sm-8">
                                    <label for="fechadenacimiento">Fecha de Nacimiento</label>
                                    <input id="fechadenacimiento" name="fechadenacimiento" required>
                                </div>
                                <div class="col-sm-4">
                                    <span>Edad:
                                        <span id="edad-span"></span>
                                    </span>
                                    <input type="hidden" id="edad" name="edad">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="escolaridad">Escolaridad</label>
                                    <input type="text" class="form-control" id="escolaridad" name="escolaridad">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="ocupacion">Ocupación</label>
                                    <input type="text" class="form-control" id="ocupacion" name="ocupacion">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="estadocivil">Estado Civil</label>
                                    <input type="text" class="form-control" id="estadocivil" name="estadocivil">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="cantidadhijos">Cantidad de Hijos</label>
                                    <input type="number" class="form-control" id="cantidadhijos" name="cantidadhijos">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="domicilio">Domicilio</label>
                                    <input type="text" class="form-control" id="domicilio" name="domicilio">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="ciudaddeorigen">Ciudad de Origen</label>
                                    <input type="text" class="form-control" id="ciudaddeorigen" name="ciudaddeorigen">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="telefono">Teléfono</label>
                                    <input type="text" class="form-control" id="telefono" name="telefono">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="email">Correo Electrónico</label>
                                    <input type="text" class="form-control" id="email" name="email">
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="enfermedades">Enfermedades</label>
                                    <textarea class="form-control" id="enfermedades" name="enfermedades"></textarea>
                                </div>
                                <div class="form-group col-12 col-sm-6">
                                    <label for="alergias">Alergias</label>
                                    <textarea class="form-control" id="alergias" name="alergias"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="responsable">Responsable</label>
                                    <input type="text" class="form-control" id="responsable" name="responsable" value="%CURRENT_USER%"
                                        readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-contactos" role="tabpanel" aria-labelledby="nav-contactos-tab">
                        <div id="contactos" class="container-fluid"></div>
                        <div class="col-12">
                            <button type="button" class="btn btn-success" id="agregar-contacto">Agregar Otro Contacto</button>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-riesgos-psicosociales" role="tabpanel" aria-labelledby="nav-riesgos-psicosociales-tab">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <h3>Individuales</h3>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="1" name="riesgos_individuales[]"
                                        id="check_individual_1">
                                    <label class="form-check-label" for="check_individual_1">
                                        INICIO TEMPRANO AL TRABAJO INFANTIL
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="2" name="riesgos_individuales[]"
                                        id="check_individual_2">
                                    <label class="form-check-label" for="check_individual_2">
                                        AUSENTISMO ESCOLAR PRESENTE
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="3" name="riesgos_individuales[]"
                                        id="check_individual_3">
                                    <label class="form-check-label" for="check_individual_3">
                                        CAPACIDADES DIFERENTES
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="4" name="riesgos_individuales[]"
                                        id="check_individual_4">
                                    <label class="form-check-label" for="check_individual_4">
                                        AISLAMIENTO O TIMIDEZ
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="5" name="riesgos_individuales[]"
                                        id="check_individual_5">
                                    <label class="form-check-label" for="check_individual_5">
                                        AGRESIVO
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="6" name="riesgos_individuales[]"
                                        id="check_individual_6">
                                    <label class="form-check-label" for="check_individual_6">
                                        CONSUMO DE DROGAS
                                    </label>
                                </div>
                                <div class="form-check col-12 pb-3">
                                    <input class="form-check-input" type="checkbox" value="7" name="riesgos_individuales[]"
                                        id="check_individual_7">
                                    <label class="form-check-label" for="check_individual_7">
                                        INTENTO SUICIDA
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <h3>Familiares</h3>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="1" name="riesgos_familiares[]"
                                        id="check_familiar_1">
                                    <label class="form-check-label" for="check_familiar_1">
                                        MALTRATO PSICOLOGICO O FISICO DE LOS PADRES
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="2" name="riesgos_familiares[]"
                                        id="check_familiar_2">
                                    <label class="form-check-label" for="check_familiar_2">
                                        CONSUMO DE ALCOHOL DE LOS PADRES
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="3" name="riesgos_familiares[]"
                                        id="check_familiar_3">
                                    <label class="form-check-label" for="check_familiar_3">
                                        PADRES QUE HUMILLAN Y HACEN SENTIR CULPA A LOS HIJOS
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="4" name="riesgos_familiares[]"
                                        id="check_familiar_4">
                                    <label class="form-check-label" for="check_familiar_4">
                                        PADRES AUSENTES
                                    </label>
                                </div>
                                <div class="form-check col-12 pb-3">
                                    <input class="form-check-input" type="checkbox" value="5" name="riesgos_familiares[]"
                                        id="check_familiar_5">
                                    <label class="form-check-label" for="check_familiar_5">
                                        EMBARAZO ADOLESCENTE
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <h3>Entorno</h3>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="1" name="riesgos_entorno[]"
                                        id="check_entorno_1">
                                    <label class="form-check-label" for="check_entorno_1">
                                        EXPUESTO A PANDILLAS O VENTA DE DROGA EN SU COLONIA
                                    </label>
                                </div>
                                <div class="form-check col-12 col-sm-6 pb-3">
                                    <input class="form-check-input" type="checkbox" value="2" name="riesgos_entorno[]"
                                        id="check_entorno_2">
                                    <label class="form-check-label" for="check_entorno_2">
                                        BAJO NIVEL SOCIO ECONOMICO
                                    </label>
                                </div>
                                <div class="form-check col-12 pb-3">
                                    <input class="form-check-input" type="checkbox" value="3" name="riesgos_entorno[]"
                                        id="check_entorno_3">
                                    <label class="form-check-label" for="check_entorno_3">
                                        PARTICIPACION EN ACTOS DELICTIVOS
                                    </label>
                                </div>
                                <div class="col-12">
                                    <h3>Observaciones</h3>
                                </div>
                                <div class="form-group col-12">
                                    <textarea id="riesgos_observaciones" name="riesgos_observaciones" class="form-control"
                                        cols="30" rows="10"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-psicotropicos" role="tabpanel" aria-labelledby="nav-psicotropicos-tab">
                        <div class="container" id="sustancias"></div>
                        <div class="col-12">
                            <button type="button" class="btn btn-success" id="agregar-sustancia">Agregar Otra Sustancia</button>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-fases" role="tabpanel" aria-labelledby="nav-fases-tab">
                        <div class="container" id="fases">
                            <div class="row">
                                <div class="col-12 col-sm-6" id="adaptabilidad">
                                    <div class="col-12">
                                        <h3>Adaptabilidad</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="adaptabilidad-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="adaptabilidad-papa"
                                                name="adaptabilidad[]" required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="adaptabilidad-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="adaptabilidad-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="adaptabilidad-mama"
                                                name="adaptabilidad[]" required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="adaptabilidad-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="adaptabilidad-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="adaptabilidad-hijo"
                                                name="adaptabilidad[]" required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="adaptabilidad-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6" id="cohesion">
                                    <div class="col-12">
                                        <h3>Cohesión</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="cohesion-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="cohesion-papa" name="cohesion[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="cohesion-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="cohesion-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="cohesion-mama" name="cohesion[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="cohesion-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="cohesion-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="6" max="30" id="cohesion-hijo" name="cohesion[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="6" max="30" id="cohesion-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6" id="rigidez">
                                    <div class="col-12">
                                        <h3>Rigidez</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="rigidez-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="rigidez-papa" name="rigidez[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="rigidez-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="rigidez-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="rigidez-mama" name="rigidez[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="rigidez-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="rigidez-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="rigidez-hijo" name="rigidez[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="rigidez-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6" id="apego">
                                    <div class="col-12">
                                        <h3>Apego</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="apego-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="apego-papa" name="apego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="apego-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="apego-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="apego-mama" name="apego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="apego-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="apego-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="apego-hijo" name="apego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="apego-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6" id="caos">
                                    <div class="col-12">
                                        <h3>Caos</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="caos-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="caos-papa" name="caos[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="caos-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="caos-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="caos-mama" name="caos[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="caos-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="caos-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="caos-hijo" name="caos[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="caos-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-sm-6" id="desapego">
                                    <div class="col-12">
                                        <h3>Desapego</h3>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="desapego-papa">Papá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="desapego-papa" name="desapego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="desapego-papa-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="desapego-mama">Mamá</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="desapego-mama" name="desapego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="desapego-mama-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-12">
                                            <label for="desapego-hijo">Hijo</label>
                                        </div>
                                        <div class="col-12 col-sm-10">
                                            <input type="range" class="slider" min="5" max="25" id="desapego-hijo" name="desapego[]"
                                                required>
                                        </div>
                                        <div class="col-12 col-sm-2">
                                            <input type="number" class="form-control" min="5" max="25" id="desapego-hijo-value"
                                                required>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 text-center">
                                            <button type="button" class="btn btn-info fases-agregar-miembro">Agregar
                                                Miembro</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-fad" role="tabpanel" aria-labelledby="nav-fad-tab">
                        <div class="container" id="fad">
                            <div class="row">
                                <div class="col-12">
                                    <h3>FAD</h3>
                                </div>
                                <div class="form-group col-12">
                                    <label for="solucion_problemas">Solución De Problemas</label>
                                    <textarea class="form-control" rows="3" id="solucion_problemas" name="solucion_problemas"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="comunicacion">Comunicación</label>
                                    <textarea class="form-control" rows="3" id="comunicacion" name="comunicacion"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="respuesta_afectiva">Respuesta Afectiva</label>
                                    <textarea class="form-control" rows="3" id="respuesta_afectiva" name="respuesta_afectiva"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="involucramiento_afectivo">Involucramiento Afectivo</label>
                                    <textarea class="form-control" rows="3" id="involucramiento_afectivo" name="involucramiento_afectivo"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="control_del_comportamiento">Control Del Comportamiento</label>
                                    <textarea class="form-control" rows="3" id="control_del_comportamiento" name="control_del_comportamiento"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="funcionamiento_general">Funcionamiento General</label>
                                    <textarea class="form-control" rows="3" id="funcionamiento_general" name="funcionamiento_general"></textarea>
                                </div>
                                <div class="form-group col-12">
                                    <label for="interpretacion_general">Interpretación General</label>
                                    <textarea class="form-control" rows="3" id="interpretacion_general" name="interpretacion_general"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <input type="hidden" id="editmode" name="editmode">
                    <input type="hidden" value="%RAND%" name="randcheck" />
                    <input type="hidden" id="contactos-delete" name="contactos_delete" />
                    <input type="hidden" id="sustancias-delete" name="sustancias_delete" />
                    <button type="submit" class="btn btn-primary" name="submitted">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    jQuery(document).ready(function ($) {
        var contactos_delete = [];
        var sustancias_delete = [];
        $(document).on('contactos_delete', function (event) {
            console.log(contactos_delete);
            $('#contactos-delete').val(contactos_delete.join(','));
        });
        $(document).on('sustancias_delete', function (event) {
            console.log(sustancias_delete);
            $('#sustancias-delete').val(sustancias_delete.join(','));
        });
        $('#fechadenacimiento').datepicker({
            uiLibrary: 'bootstrap4',
            format: 'yyyy-mm-dd'
        });

        $('#fechadenacimiento').change(function () {
            let nacimiento = new Date($(this).val());
            let diferenciaMs = new Date(Date.now() - nacimiento.getTime());
            let edad = Math.abs(diferenciaMs.getUTCFullYear() - 1970);

            $('#edad').val(edad);
            $('#edad-span').html(edad);
        });

        var contador_contactos = 0;
        // agregarContacto(contador_contactos);
        $('#agregar-contacto').on('click', function () {
            contador_contactos++;
            agregarContacto(contador_contactos);
        });

        function agregarContacto(index) {
            var formulario = '\
            <div id="contacto' + index + '" class="row border">\
                <div class="form-group col-12 col-sm-6">\
                    <label>Nombre</label>\
                    <input type="text" class="form-control" id="nombre-' + index + '" name="nombrescontacto[]" required>\
                    <input type="text" class="form-control" id="id-' + index + '" name="idscontacto[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label>Relación</label>\
                    <input type="text" class="form-control" id="relacion-' + index + '" name="relacionescontacto[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label>Domicilio</label>\
                    <input type="text" class="form-control" id="domicilio-' + index + '" name="domicilioscontacto[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label>Teléfono Celular</label>\
                    <input type="text" class="form-control" id="telefono_celular-' + index + '" name="celularescontacto[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label>Teléfono Casa</label>\
                    <input type="text" class="form-control" id="telefono_casa-' + index + '" name="telcasacontacto[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label>Otro Teléfono</label>\
                    <input type="text" class="form-control" id="telefono_otro-' + index + '" name="otrostelefonoscontacto[]">\
                </div>\
                <div class="col-12" id="eliminar-btn' + index + '">\
                    <button type="button" class="btn btn-danger" id="eliminar-contacto' + index + '" data-i="' + index + '">Eliminar Contacto</button>\
                </div>\
            </div>';


            $('#contactos').append(formulario);
            $('#eliminar-btn0').remove();

            $('#eliminar-contacto' + index).on('click', function () {
                var index = $(this).data("i");
                eliminarContacto(index);
            });
        }

        function eliminarContacto(index) {
            var id = $('#id-' + index).val();
            if (id) {
                contactos_delete.push(id);
                $(document).trigger('contactos_delete');
            }
            $('#contacto' + index).remove();
            contador_contactos--;
        }

        var contador_sustancias = 0;
        // agregarSustancia(contador_sustancias);
        $('#agregar-sustancia').on('click', function () {
            contador_sustancias++;
            agregarSustancia(contador_sustancias);
        });

        function agregarSustancia(index) {
            var formulario = '\
            <div id="sustanciadiv' + index + '" class="row border">\
                <input type="hidden" class="form-control" id="id' + index + '" name="idssustancias[]">\
                <div class="form-group col-12">\
                    <label for="sustancia' + index + '">Sustancia</label>\
                    <select class="form-control" id="sustancia' + index + '" name="sustancia[]">\
                        <option>Alcohol Fermentado (Vino, cerveza, pulque)</option>\
                        <option>Alcohol Destilado (Brandy, Vodka, Ron)</option>\
                        <option>Alcohol 96</option>\
                        <option>Opiáceos, Heroína u Otros</option>\
                        <option>Marihuana</option>\
                        <option>Sedantes, Hipnóticos y Ansiolíticos</option>\
                        <option>Cocaína</option>\
                        <option>Anfetamínicos, Éxtasis</option>\
                        <option>Cafeína</option>\
                        <option>Alucinógenos</option>\
                        <option>Fenilciclidina PCP</option>\
                        <option>Nicotína</option>\
                        <option>Disolventes Volátiles</option>\
                        <option>Antiparkinsónicos</option>\
                        <option>Otro</option>\
                    </select>\
                </div>\
                <div id="otrasustanciacontainer' + index + '" class="col-12"></div>\
                <div class="form-group col-12 col-sm-4">\
                    <label for="añoprimeruso' + index + '">Año Del Primer Uso</label>\
                    <input type="number" class="form-control" id="añoprimeruso' + index + '" name="añoprimeruso[]">\
                </div>\
                <div class="form-group col-12 col-sm-4">\
                    <label for="edadprimeruso' + index + '">Edad Del Primer Uso</label>\
                    <input type="number" class="form-control" id="edadprimeruso' + index + '" name="edadprimeruso[]">\
                </div>\
                <div class="form-group col-12 col-sm-4">\
                    <label for="usoregular' + index + '">Uso Regular</label>\
                    <input type="text" class="form-control" id="usoregular' + index + '" name="usoregular[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="periodo' + index + '">Periodo</label>\
                    <select class="form-control" id="periodo' + index + '" name="periodo[]">\
                        <option>1 Al Día</option>\
                        <option>2-3/Día</option>\
                        <option>+ 3/Día</option>\
                        <option>1/ Semana</option>\
                        <option>2-3/ Semana</option>\
                        <option>+ 3/ Semana</option>\
                        <option>1/ Mes</option>\
                        <option>2-3/ Mes</option>\
                        <option>+ 3/ Mes</option>\
                        <option>No Procede</option>\
                        <option>Otro</option>\
                    </select>\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="unidad' + index + '">Unidad</label>\
                    <select class="form-control" id="unidad' + index + '" name="unidad[]">\
                        <option>Copas</option>\
                        <option>Botellas</option>\
                        <option>Ampolletas</option>\
                        <option>Comprimidos</option>\
                        <option>Cigarros</option>\
                        <option>Comprimidos</option>\
                        <option>Cápsulas</option>\
                        <option>Grageas</option>\
                        <option>Grapa</option>\
                        <option>Envoltorio</option>\
                        <option>Tazas</option>\
                        <option>Hongos</option>\
                        <option>Cigarros</option>\
                        <option>Estopa, Bolsa, etc.</option>\
                        <option>Tabletas</option>\
                        <option>Otro</option>\
                    </select>\
                </div>\
                <div id="otraperiodocontainer' + index + '" class="col-12"></div>\
                <div id="otraunidadcontainer' + index + '" class="col-12"></div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="abstinenciamaxima' + index + '">Abstinencia Máxima</label>\
                    <input type="text" class="form-control" id="abstinenciamaxima' + index + '" name="abstinenciamaxima[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="abstinenciaactual' + index + '">Abstinencia Actual</label>\
                    <input type="text" class="form-control" id="abstinenciaactual' + index + '" name="abstinenciaactual[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="viadeuso' + index + '">Via de Uso / Administración</label>\
                    <input type="text" class="form-control" id="viadeuso' + index + '" name="viadeuso[]">\
                </div>\
                <div class="form-group col-12 col-sm-6">\
                    <label for="fechaultimoconsumo' + index + '">Fecha del Último Consumo</label>\
                    <input id="fechaultimoconsumo' + index + '" name="fechaultimoconsumo[]">\
                </div>\
                <div class="col-12" id="eliminar-sustancia-btn' + index + '">\
                    <button type="button" class="btn btn-danger" id="eliminar-sustancia' + index + '" data-i="' + index + '">Eliminar Sustancia</button>\
                </div>\
            </div>\
            ';

            $('#sustancias').append(formulario);
            $('#fechaultimoconsumo' + index).datepicker({
                uiLibrary: 'bootstrap4',
                format: 'yyyy-mm-dd'
            });
            $('#eliminar-sustancia-btn0').remove();

            $('#eliminar-sustancia' + index).on('click', function () {
                var index = $(this).data("i");
                eliminarSustancia(index);
            });

            $('#sustancia' + index).change(function () {
                $('#sustancia' + index + ' option:selected').each(function () {
                    if ($(this).text() === 'Otro') {
                        $('#otrasustanciacontainer' + index).append('\
                            <div id="otrasustanciadiv' + index + '" class="form-group col-12">\
                                <label for="otrasustancia' + index + '">Otra Sustancia</label>\
                                <input type="text" class="form-control" id="otrasustancia' + index + '" name="otrasustancia[]">\
                            </div>');
                    } else {
                        $('#otrasustanciadiv' + index).remove();
                    }
                });
            });

            $('#periodo' + index).change(function () {
                $('#periodo' + index + ' option:selected').each(function () {
                    if ($(this).text() === 'Otro') {
                        $('#otraperiodocontainer' + index).append('\
                            <div id="otraperiododiv' + index + '" class="form-group col-12">\
                                <label for="otraperiodo' + index + '">Otro Periodo</label>\
                                <input type="text" class="form-control" id="otraperiodo' + index + '" name="otraperiodo[]">\
                            </div>');
                    } else {
                        $('#otraperiodocontainer' + index).remove();
                    }
                });
            });

            $('#unidad' + index).change(function () {
                $('#unidad' + index + ' option:selected').each(function () {
                    if ($(this).text() === 'Otro') {
                        $('#otraunidadcontainer' + index).append('\
                            <div id="otraunidaddiv' + index + '" class="form-group col-12">\
                                <label for="otraunidad' + index + '">Otra Unidad</label>\
                                <input type="text" class="form-control" id="otraunidad' + index + '" name="otraunidad[]">\
                            </div>');
                    } else {
                        $('#otraunidadcontainer' + index).remove();
                    }
                });
            });
        }

        function eliminarSustancia(index) {
            var id = $('#id' + index).val();
            if (id) {
                sustancias_delete.push(id);
                $(document).trigger('sustancias_delete');
            }
            $('#sustanciadiv' + index).remove();
            contador_sustancias--;
        }

        $("#fotografia").change(function () {
            previsualizarFoto(this);
        });
        function previsualizarFoto(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#fotografia_element').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        function sliders() {
            $('input[type="range"]').each(function (index) {
                var slider = $('#' + $(this).attr('id'));
                var value = $('#' + $(this).attr('id') + '-value');

                value.val(slider.val());
                slider.on('change', function () {
                    value.val($(this).val());
                });

                value.on('change', function () {
                    slider.val($(this).val());
                });
            });
        }
        sliders();

        var rangos = {
            'adaptabilidad': {
                min: 6,
                max: 30,
            },
            'cohesion': {
                min: 6,
                max: 30,
            },
            'rigidez': {
                min: 5,
                max: 25,
            },
            'apego': {
                min: 5,
                max: 25,
            },
            'caos': {
                min: 5,
                max: 25,
            },
            'desapego': {
                min: 5,
                max: 25,
            },
        };
        var fases = [];
        $('.fases-agregar-miembro').each(function (index) {
            fases[index] = {
                i: 0
            };
            $(this).on('click', function () {
                var container = $(this).parent().parent().parent();
                fases[index].fase = container.attr('id');
                var div = '\
                <div class="form-group row">\
                    <div class="col-12 col-sm-8">\
                        <input type="text" class="form-control" placeholder="Nombre" id="' + fases[index].fase + fases[index].i + '-name" name="' + fases[index].fase + '-name[]" required>\
                    </div>\
                    <div class="col-12 col-sm-4 text-center">\
                        <button type="button" class="btn btn-danger" id="fases-eliminar-miembro-' + fases[index].fase + '-' + fases[index].i + '">Eliminar Miembro</button>\
                    </div>\
                    <div class="col-12 col-sm-10">\
                        <input type="range" class="slider" min="' + rangos[fases[index].fase].min + '" max="' + rangos[fases[index].fase].max + '" id="' + fases[index].fase + fases[index].i + '" name="' + fases[index].fase + '[]" required>\
                    </div>\
                    <div class="col-12 col-sm-2">\
                        <input type="number" class="form-control" min="' + rangos[fases[index].fase].min + '" max="' + rangos[fases[index].fase].max + '" id="' + fases[index].fase + fases[index].i + '-value" required>\
                    </div>\
                </div>';

                container.append(div);

                $('#fases-eliminar-miembro-' + fases[index].fase + '-' + fases[index].i).on('click', function () {
                    $(this).parent().parent().remove();
                    fases[index].i--;
                    sliders();
                });

                fases[index].i++;
                sliders();
            });
        });

        var paciente = null;
        try {
            paciente = JSON.parse('%PACIENTE%');
        } catch (e) {
            console.error(e);
        }

        console.log(paciente);
        if (paciente && !paciente['error']) {
            $('#editmode').val('1');
            // Titulo
            $('#nombre_title').html(paciente.nombre);

            // Llenar Informacion Personal
            $('#fotografia_element').attr("src", paciente.fotografia);
            for (var key of Object.keys(paciente)) {
                var element = $(`#${key}`);
                if (element.hasClass('form-control') && key !== 'fotografia') {
                    element.val(paciente[key]);
                    if (key === 'fechadenacimiento') {
                        element.trigger('change');
                    }
                }
            }

            // Llenar Contactos
            for (var [index, contacto] of paciente.contactos.entries()) {
                contador_contactos++;
                agregarContacto(contador_contactos);
                for (var key of Object.keys(contacto)) {
                    var element = $(`#${key}-${index + 1}`);
                    if (element.hasClass('form-control')) {
                        element.val(contacto[key]);
                    }
                }
            }

            // Llenar Riesgos
            function checkRiesgos(tipo, valores) {
                for (var valor of valores.split(',')) {
                    $(`#check_${tipo}_${valor}`).prop('checked', true);
                }
            }
            if (paciente.riesgos) {
                if (paciente.riesgos.individual) {
                    checkRiesgos('individual', paciente.riesgos.individual);
                }
                if (paciente.riesgos.familiar) {
                    checkRiesgos('familiar', paciente.riesgos.familiar);
                }
                if (paciente.riesgos.entorno) {
                    checkRiesgos('entorno', paciente.riesgos.entorno);
                }
                $('#riesgos_observaciones').val(paciente.riesgos.observaciones);
            }

            // Llenar sustancias
            for (var [index, sustancia] of paciente.sustancias.entries()) {
                contador_sustancias++;
                agregarSustancia(contador_sustancias);
                for (var key of Object.keys(sustancia)) {
                    var element = $(`#${key}${index + 1}`);
                    if (element.hasClass('form-control') || element.hasClass('form-check-input')) {
                        element.val(sustancia[key]);
                        if ((key === 'periodo' || key === 'unidad' || key === 'sustancia') && !element.val()) {
                            // & sustancia[key] === 'Otro'
                            element.val('Otro');
                            element.trigger('change');
                            $('#otra' + key + (index + 1)).val(sustancia[key]);
                        }
                    }
                }
            }

            // Llenar Fases
            if (paciente.fases) {
                for (var key of Object.keys(paciente.fases)) {
                    if (paciente.fases[key].length > 3) {
                        var elementos_extra = paciente.fases[key].length - 3;
                        for (let index = 0; index < elementos_extra; index++) {
                            $('#' + key).find('.fases-agregar-miembro')[0].click();
                        }
                    }
                    $('input[name="' + key + '[]"]').each(function (index) {
                        if (index < 3) {
                            $(this).val(paciente.fases[key][index]);
                        } else {
                            $(this).val(paciente.fases[key][index].valor);
                            $('#' + key + $(this).attr('id').replace(key, '') + '-name').val(paciente.fases[key][index].nombre);
                        }
                    });
                }
                sliders();
            }

            // Llenar FAD
            if (paciente.fad) {
                for (var key of Object.keys(paciente.fad)) {
                    $('#' + key).val(paciente.fad[key]);
                }
            }

        } else if (paciente && paciente['error']) {
            $('#error_title').html('PACIENTE NO ENCONTRADO<br><a href="/pacientes">Volver a la lista</a>');
            $('.container').hide();
        }
    });
</script>